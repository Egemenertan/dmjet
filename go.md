 KullanÄ±cÄ± Butona TÄ±klar
authStore.tsLines 90-236
signInWithGoogle: async () => {    console.log('ğŸš€ Starting Google OAuth...')    set({ loading: true })        // Cleanup function    const cleanup = async () => {      try {        await WebBrowser.dismissAuthSession()      } catch {        // Ignore cleanup errors      }    }        try {      // 1. Initial cleanup      await cleanup()      console.log('ğŸ§¹ Session cleaned up')            // 2. Start OAuth with optimized settings      const { data, error } = await supabase.auth.signInWithOAuth({        provider: 'google',        options: {          redirectTo: 'deliverymobile://google-auth',          queryParams: {            access_type: 'offline',            prompt: 'select_account', // Better UX than 'consent'          },        },      })      if (error || !data?.url) {        console.error('âŒ OAuth URL hatasÄ±:', error?.message)        set({ loading: false })        return { error: 'Google OAuth baÄŸlantÄ±sÄ± kurulamadÄ±' }      }      console.log('ğŸ”— Opening OAuth browser...')            // 3. Open browser with reasonable timeout (60 seconds)      const browserResult = await Promise.race([        WebBrowser.openAuthSessionAsync(data.url, 'deliverymobile://google-auth'),        new Promise<never>((_, reject) => {          setTimeout(() => reject(new Error('Browser timeout')), 60000) // 1 minute        })      ])      // 4. Handle browser results      if (browserResult.type === 'cancel') {        console.log('â„¹ï¸ KullanÄ±cÄ± iptal etti')        set({ loading: false })        return { error: 'Google giriÅŸ iptal edildi' }      }      if (browserResult.type !== 'success' || !browserResult.url) {        console.error('âŒ Browser session baÅŸarÄ±sÄ±z:', browserResult.type)        set({ loading: false })        return { error: 'OAuth akÄ±ÅŸÄ± tamamlanamadÄ±' }      }      console.log('âœ… Browser OAuth baÅŸarÄ±lÄ±, URL process ediliyor...')      // 5. Process the returned URL with Supabase      console.log
2. Supabase OAuth URL'i OluÅŸturur
authStore.tsLines 109-118
const { data, error } = await supabase.auth.signInWithOAuth({        provider: 'google',        options: {          redirectTo: 'deliverymobile://google-auth',          queryParams: {            access_type: 'offline',            prompt: 'select_account', // Better UX than 'consent'          },        },      })
Burada neler oluyor:
provider: 'google' â†’ Google OAuth kullanÄ±lacak
redirectTo: 'deliverymobile://google-auth' â†’ GiriÅŸ sonrasÄ± uygulamaya dÃ¶nÃ¼ÅŸ URL'i (Deep Link)
access_type: 'offline' â†’ Refresh token almak iÃ§in
prompt: 'select_account' â†’ KullanÄ±cÄ± her seferinde hesap seÃ§ebilir
3. WebBrowser ile Google GiriÅŸ SayfasÄ± AÃ§Ä±lÄ±r
authStore.tsLines 129-134
const browserResult = await Promise.race([        WebBrowser.openAuthSessionAsync(data.url, 'deliverymobile://google-auth'),        new Promise<never>((_, reject) => {          setTimeout(() => reject(new Error('Browser timeout')), 60000) // 1 minute        })      ])
Bu adÄ±mda:
expo-web-browser paketi kullanÄ±larak sistem tarayÄ±cÄ±sÄ± aÃ§Ä±lÄ±r
KullanÄ±cÄ± Google hesabÄ±nÄ± seÃ§er ve giriÅŸ yapar
60 saniye timeout var (kullanÄ±cÄ± Ã§ok uzun sÃ¼re beklerse iptal olur)
4. Google'dan Token'lar AlÄ±nÄ±r
KullanÄ±cÄ± Google'da giriÅŸ yaptÄ±ktan sonra, Google ÅŸu URL ile uygulamaya geri dÃ¶ner:
deliverymobile://google-auth#access_token=xxx&refresh_token=yyy&...
authStore.tsLines 152-218
console.log('ğŸ”„ URL process ediliyor:', browserResult.url.substring(0, 100) + '...')            try {        // Extract the URL fragment (after #)        const url = new URL(browserResult.url)        const fragment = url.hash.substring(1) // Remove the #                if (!fragment) {          console.error('âŒ URL fragment bulunamadÄ±')          set({ loading: false })          return { error: 'OAuth response formatÄ± geÃ§ersiz' }        }        // Parse the fragment as query parameters        const params = new URLSearchParams(fragment)        const access_token = params.get('access_token')        const refresh_token = params.get('refresh_token')                if (!access_token || !refresh_token) {          console.error('âŒ Tokenlar URLde bulunamadÄ±')          set({ loading: false })          return { error: 'OAuth tokenlari alÄ±namadÄ±' }        }        console.log('ğŸ” Tokenlar alÄ±ndÄ±, session kuruluyor...')                // Set the session with extracted tokens        const { data: sessionData, error: sessionError } = await supabase.auth.setSession({          access_token,          refresh_token,        })        if (sessionError) {          console.error('âŒ Session kurulum hatasÄ±:', sessionError.message)          set({ loading: false })          return { error: `Session kurulumu baÅŸarÄ±sÄ±z: ${sessionError.message}` }        }        if (!sessionData.session?.user) {          console.error('âŒ Session kuruldu ama user bilgisi yok')          set({ loading: false })          return { error: 'KullanÄ±cÄ± bilgileri alÄ±namadÄ±' }        }        console.log('âœ… OAuth baÅŸarÄ±lÄ±! User:', sessionData.session.user.email)                // Update state immediately        set({           user: sessionData.session.user,          session: sessionData.session,          loading: false         })        // Fetch profile in background        try {          await get().fetchProfile()        } catch (profileError) {          console.warn('âš ï¸ Profile fetch failed:', profileError)        }        return { error: undefined }      } catch (urlError) {        console.error('âŒ URL processing hatasÄ±:', urlError)        set({ loading: false })        return { error: 'OAuth response iÅŸlenemedi' }      }
Token Ä°ÅŸleme:
URL'den # sonrasÄ± fragment alÄ±nÄ±r
access_token ve refresh_token parse edilir
Supabase'e setSession() ile gÃ¶nderilir
Session kurulur ve kullanÄ±cÄ± bilgileri alÄ±nÄ±r
5. KullanÄ±cÄ± Profili Ã‡ekilir
authStore.tsLines 395-415
fetchProfile: async () => {    const { user } = get()    if (!user) return    try {      const { data, error } = await supabase        .from('profiles')        .select('*')        .eq('id', user.id)        .single()      if (error && error.code !== 'PGRST116') {        console.error('Error fetching profile:', error)        return      }      set({ profile: data })    } catch (error) {      console.error('Error fetching profile:', error)    }  },
6. Uygulama Ä°Ã§i YÃ¶nlendirme
LoginScreen.tsxLines 115-177
const handleGoogleLogin = async () => {    setGoogleLoading(true)    try {      const { error } = await signInWithGoogle()      if (error) {        showMessage({          message: t('auth.googleLoginError') || 'Google GiriÅŸ HatasÄ±',          description: error,          type: 'danger',          duration: 4000,        })      } else {        // Navigate to returnTo screen if specified        if (returnTo === 'MapSelection') {          // Use CommonActions to navigate across navigators          navigation.dispatch(            CommonActions.reset({              index: 0,              routes: [                {                  name: 'Main',                  state: {                    routes: [                      { name: 'MainTabs' },                      { name: 'MapSelection', params: returnParams }                    ],                    index: 1                  }                }              ]            })          )        } else if (returnTo === 'Profile') {          // Navigate back to Profile screen          navigation.dispatch(            CommonActions.reset({              index: 0,              routes: [                {                  name: 'Main',                  state: {                    routes: [                      {                         name: 'MainTabs',                        state: {                          routes: [                            { name: 'Home' },                            { name: 'Categories' },                            { name: 'Cart' },                            { name: 'Profile' }                          ],                          index: 3 // Profile tab index                        }                      }                    ],                    index: 0                  }                }              ]            })          )        }      }    } catch (e) {      showMessage({        message: t('errors.generic'),
YÃ¶nlendirme MantÄ±ÄŸÄ±:
EÄŸer kullanÄ±cÄ± MapSelection ekranÄ±ndan geliyorsa â†’ oraya geri dÃ¶ner
EÄŸer Profile ekranÄ±ndan geliyorsa â†’ Profile tab'Ä±na dÃ¶ner
Yoksa normal akÄ±ÅŸ devam eder



app.json - Deep link scheme:
app.jsonLines 73-85
{  "expo": {    "scheme": "deliverymobile",    "ios": {      "bundleIdentifier": "com.anonymous.deliverymobile"    },    "android": {      "package": "com.anonymous.deliverymobile"    }  }